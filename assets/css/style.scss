$main-fg-color: #000;

$main-bg-color: #fff;
$secondary-bg-color: #eee;

$window-border-color: #ddd;
$window-background-color: #f2f2f2;

$section-divider-bar-color: #d5d5d5;

$table-border-colour: #d5d5d5;
$table-header-background: linear-gradient(#eee 0%, #ccc 100%);

$dragbar-color: #b38b0d;

// 3d-effect borders, drag handles
$th-border-right: #bbb;
$th-border-left: #fff;

$progress-border-color: #bbb;
$progress-fill-color: #8d8;

$selected-row-color: #fff;
$selected-row-background-color: rgb(58, 121, 245);

$sidebar-width: 170px;
$main-width: calc(100vw - #{$sidebar-width});

$header-height: 40px;
$details-height: 200px;
$summary-height: 20px;
// 2.3 is magic, determined by seeing how high speed-chart was when left to auto
$speed-chart-height: calc(#{$sidebar-width} / 2.3);
$group-lists-height: calc(100vh - #{$summary-height} - #{$speed-chart-height} - #{$header-height});
$torrents-height: calc(100vh - #{$summary-height} - #{$details-height} - #{$header-height});

$thead-z-index: 1;
$messages-z-index: 5;
$resize-handle-z-index: 5;
$speed-chart-z-index: 5;
$dragbar-z-index: 10;
$hamburger-menu-z-index: 50;
$context-menu-z-index: 50;
$window-z-index: 50;

@mixin unselectable {
  -webkit-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

html {
  box-sizing: border-box;
}

*,
*::before,
*::after {
  box-sizing: inherit;
}

body {
  margin: 0;
  overflow: hidden;
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,sans-serif;
  font-size: 14px;
}

ul {
  margin: 0;
  padding: 0;
  list-style: none;
}

.text-right {
  text-align: right;
}

.flex {
  display: flex;
}

.resizing-x * {
  cursor: col-resize;
}

.context-menu {
  position: absolute;
  top: 50px;
  left: 50px;

  z-index: $context-menu-z-index;
  border: 1px solid $window-border-color;
  border-radius: 5px;
  box-shadow: 0 0 15px 3px #ccc;
  background: $window-background-color;

  li {
    padding: 4px 10px;

    &:hover {
      background: $selected-row-background-color;
      color: $selected-row-color;
    }
  }
}

.dragbar {
  position: fixed;
  top: 0;
  bottom: 0;
  left: 0;
  z-index: $dragbar-z-index;
  background-color: $dragbar-color;
  cursor: col-resize;
  width: 1px;
}

.window {
  display: none;
  position: absolute;
  z-index: $window-z-index;
  margin: 40px;
  border: 1px solid $window-border-color;
  border-radius: 5px;
  box-shadow: 0 0 15px 10px #888;
  background: $window-background-color;
  overflow-y: auto;

  // works great in Firefox, not so much Safari.
  // TODO: get updated coords to elm..
  // https://stackoverflow.com/questions/6492683/how-to-detect-divs-dimension-changed
  resize: both;
  min-width: 200px;
  min-height: 200px;

  &.visible {
    display: block;
  }

  .titlebar {
    display: flex;
    position: sticky;
    top: 0;
    left: 0;
    align-items: center;
    border-bottom: 1px solid #999;
    background: $table-header-background;
    width: 100%;
    height: 30px;
    font-size: 1.1rem;
  }

  .close-icon {
    margin: 10px;
    color: #a00;

    &:hover {
      color: #f00;
    }
  }
}

.navigation {
  display: flex;
  justify-content: space-between;
  border-bottom: 1px solid $section-divider-bar-color;
  background-color: $secondary-bg-color;
  padding: 5px;
  height: $header-height;
}

.filter {
  display: flex;
  margin-right: 10px;
  width: 250px;

  input {
    border: 1px solid #aaa;
    border-left: 0;
    padding: 5px;

    &:focus {
      outline: 0;
    }
  }

  &.error {
    background-color: #ecc;
  }
}

.hamburger-button {
  display: flex;
  position: relative;
}

.messages {
  position: absolute;
  top: $header-height - 10px; // 10px margin on first li
  right: 5px;
  z-index: $messages-z-index;

  li {
    position: relative;
    margin: 10px 0;
    border-radius: 5px;
    padding: 10px;
  }
}

.hamburger-menu {
  @include unselectable;

  position: absolute;
  top: 0;
  right: 0;
  z-index: $hamburger-menu-z-index;
  border: 1px outset #555;
  background-color: $main-bg-color;
  color: #555;

  ul {
    white-space: nowrap;

    i {
      width: 30px;
    }
  }

  li {
    cursor: default;
    padding: 10px 20px;

    &:hover {
      background: $selected-row-background-color;
      color: $selected-row-color;
    }
  }
}

.preferences {
  width: 400px;
  height: 600px;

  ol {
    flex-grow: 1;
    margin: 0;
    padding-left: 10px;
  }

  .column {
    display: flex;
    margin: 5px 0;
    padding: 5px;

    i { margin-right: 10px; }
  }

  .draggable {
    flex-grow: 1;
    cursor: ns-resize;
  }

  .column-moving {
    background: inherit;
    color: #aaa;
  }

  .column-visible {
    background: #ddd;
  }

  .column-hidden {
    background: #eee;
    color: #aaa;
  }
}

.fieldset-header {
  background-color: $main-bg-color;
  padding: 10px;
}

.preference {
  display: flex;
  margin: 10px;
  padding: 10px 0;
}

.preference-label {
  width: 100px;
}

.preference-option {
  display: flex;
  padding: 10px;

  input {
    // this feels wrong, its just to try and line up the radio buttons with labels :(
    margin-top: 3px;
  }

  &:first-child {
    padding-top: 0;
  }
}

.preference-text {
  display: inline-block;
  padding-left: 5px;

  small {
    display: block;
    color: #555;
  }
}

.logs {
  width: calc(100% - 80px);
  height: 600px;

  ol {
    padding: 0;

    li {
      display: flex;
      margin: 10px;
      background-color: #fafaaf;
      padding: 10px;
    }
  }

  .content {
    margin-left: 20px;
  }
}

.messages,
.logs {
  .time {
    display: block;
    font-size: .6rem;
    font-weight: bold;
  }

  .error {
    border: 1px solid #ecc;
    background: #fdd;
    color: #811;
  }

  .warning {
    border: 1px solid #ec9;
    background: #fda;
    color: #761;
  }

  .info {
    border: 1px solid #cdc;
    background: #ded;
    color: #484;
  }
}

.sidebar {
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
  justify-content: space-between;
  border-right: 1px solid $section-divider-bar-color;
  width: $sidebar-width;
}

.main {
  flex-grow: 1;
  background-color: $secondary-bg-color;
  width: $main-width;
}

.group-lists {
  display: flex;
  flex-direction: column;
  background-color: $main-bg-color;
  height: $group-lists-height;
  overflow: auto;
  font-size: 12px;

  .header {
    margin: 0;
    border-top: 1px solid $section-divider-bar-color;
    background: $table-header-background;
    padding: 5px;
    font-size: 10px;
    font-variant: small-caps;
  }

  .group-list:first-child .header {
    border-top: 0;
  }

  ul {
    padding: 0 0 5px;
  }

  li {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 3px 0;

    > span {
      padding: 0 5px;
    }
  }

  .label {
    display: flex;
    align-items: center;
    overflow: hidden; // hide excess state/label/tracker strings
  }

  i,
  img {
    margin-right: 5px;
  }
}

.torrent-table {
  height: $torrents-height;
  overflow: auto;
}

.loading {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 5rem;
}

.details {
  border-top: 1px solid $section-divider-bar-color;
  background: $secondary-bg-color;
  height: $details-height;
}

.details-table {
  height: $details-height;
}

.speed-chart {
  z-index: $speed-chart-z-index;
  border-top: 1px solid $section-divider-bar-color;
  background-color: $main-bg-color;
  font-size: .8rem;

  &:hover {
    border: 1px solid #888;
    position: absolute;
    left: 5px;
    bottom: 5px;
    width: 90%;
    height: auto;
  }
}

.summary {
  display: flex;
  position: relative;
  align-items: stretch;
  justify-content: space-between;
  border-top: 1px solid $section-divider-bar-color;
  background: $secondary-bg-color;
  padding: 2px;
  width: 100%;
  height: $summary-height;
  white-space: nowrap;
  font-size: 10px;

  .connected {
    color: #080;
  }

  .disconnected {
    color: #f00;
  }
}

.system-info {
  display: flex;
  align-items: center;
  padding: 0 5px;

  .fas {
    padding-left: 5px;
  }
}

.session-traffic {
  display: flex;
  align-items: center;

  .fas {
    padding-right: 5px;
  }

  .stat {
    border-right: 1px solid #888;
    padding: 0 5px;
  }
}

.torrent-status {
  font-size: .5rem;

  &.seeding {
    color: #292;
  }

  &.errored {
    color: #a22;
  }

  &.downloading {
    color: #38e;
  }

  &.paused {
    color: #d80;
  }

  &.stopped {
    color: #ccc;
  }

  // hashing
  &.hashing {
    color: #777;
  }
}

.progress-container {
  position: relative;

  progress {
    border: 1px solid $progress-border-color;
    background-color: inherit;
    width: 100%;
    height: 16px;
    vertical-align: middle;
    color: $progress-fill-color;

    -webkit-appearance: none;
    appearance: none;

    &::-webkit-progress-bar {
      background-color: $main-bg-color;
    }

    &::-moz-progress-bar {
      background-color: $progress-fill-color;
    }

    &::-webkit-progress-value {
      background-color: $progress-fill-color;
    }
  }

  span {
    display: flex;
    position: absolute;
    top: 0;
    left: 0;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    color: $main-fg-color; // override tr.selected
    font-size: smaller;
  }
}

table {
  background-color: $main-bg-color;
  cursor: default;
  border-spacing: 0;
  font-size: 11px;

  &.fixed {
    table-layout: fixed;
  }
}

thead {
  @include unselectable;

  position: sticky;
  top: 0;
  z-index: $thead-z-index; // stop progress-bars overlaying headers
}

tr {
  &:hover {
    background-color: lighten($selected-row-background-color, 35%);
  }

  &.selected {
    background-color: $selected-row-background-color;
    color: $selected-row-color;
  }
}

th {
  position: relative; // so the dragbar can anchor to the right

  border-right: 1px solid $th-border-right;
  border-bottom: 1px solid $table-border-colour;
  border-left: 1px solid $th-border-left;

  background: $table-header-background;

  // changing this 4px l/r padding requires a change in elm.
  // see TorrentTable widthAttribute methods
  padding: 0 4px;

  text-align: left;

  &:first-child {
    border-left: 0;
  }

  &:last-child {
    border-right: 0;
  }

  &.sorted {
    &.descending {
      background: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='50' style='fill:none;stroke:currentColor;stroke-width:5'><polygon points='0,0 100,0 50,50'/></svg>") calc(100% - 2px) center / 10px no-repeat, $table-header-background;
    }

    &.ascending {
      background: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='50' style='fill:none;stroke:currentColor;stroke-width:5'><polygon points='50,0 0,50 100,50'/></svg>") calc(100% - 2px) center / 10px no-repeat, $table-header-background;
    }
  }

  .content {
    padding: 4px 10px 4px 0;
  }

  .resize-handle {
    position: absolute;
    top: 0;
    right: 0;
    z-index: $resize-handle-z-index;
    margin-right: -3px;
    cursor: col-resize;
    width: 6px;
    height: 100%;
  }
}

td {
  border-bottom: 1px solid $table-border-colour;

  // changing this 4px l/r padding requires a change in elm.
  // see TorrentTable widthAttribute methods
  padding: 2px 4px;

  div { // cell content to apply width style to
    overflow: hidden;
    white-space: nowrap;
  }
}

fieldset {
  margin: 10px;
  padding: 0;
}
